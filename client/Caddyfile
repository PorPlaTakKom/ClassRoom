{
  email {$ACME_EMAIL}
}

{$DOMAIN:localhost} {

  encode gzip

  # LiveKit signaling + WebSocket (ต้องเป็น root)
  @livekit {
    not path /api/* /socket.io/* /metrics
  }
  reverse_proxy @livekit livekit:7880

  # Backend API + Socket.IO
  @api path /api/* /socket.io/* /metrics
  reverse_proxy @api server:4000

  # Frontend (React build)
  handle {
    root * /srv
    try_files {path} /index.html
    file_server
  }
}
